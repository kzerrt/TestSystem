<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Update</title>
    <style>
        .el-table .warning-row {
            background: lightcoral;
        }
    </style>
</head>
<body>

<script src="../js/axios-0.18.0.js"></script>
<script src="../js/vue.js"></script>
<script src="../element-ui/lib/index.js"></script>
<link rel="stylesheet" href="../element-ui/lib/theme-chalk/index.css">

<div id="app">

    <template>
        <el-table
                :data="tableData"
                height="500"
                style="width: 100%"
                :row-class-name="tableRowClassName">
            <el-table-column
                    label="序号"
                    type="index"
                    width="100">
            </el-table-column>
            <el-table-column
                    prop="code"
                    label="学号"
                    width="120">
            </el-table-column>
            <el-table-column
                    prop="name"
                    label="姓名"
                    width="120">
            </el-table-column>
            <el-table-column
                    prop="sex"
                    label="性别"
                    width="60">
            </el-table-column>
            <el-table-column
                    prop="dept"
                    label="专业"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="course"
                    label="课程"
                    width="160">
            </el-table-column>
            <el-table-column
                    prop="grade"
                    label="分数"
                    width="60">
            </el-table-column>
            <el-table-column label="操作">
                <template slot-scope="scope">
                    <el-form :inline="true">
                        <el-form-item >
                            <el-popover
                                    placement="right"
                                    width="20"
                                    trigger="click">
                                <el-input
                                        @change="update(scope.row)"
                                        size="small"
                                        v-model.number="scope.row.grade"
                                        style="width: 60px"
                                ></el-input>
                                <el-button slot="reference">修改成绩</el-button>
                            </el-popover>

                        </el-form-item>
                    </el-form>
                </template>
            </el-table-column>
        </el-table>
    </template>

</div>

<script>

    new Vue({
        el: "#app",
        mounted(){
            /*初始化加载学生信息*/
            axios({
                url:'/web/a/showStuInfoByTeachServlet',
                method:'post',
                data:'grade'
            }).then(resp => {
                var _this = this;
                let stus    = resp.data;
                _this.tableData = stus;
            })
        },
        methods: {
            succ(msg) {
                this.$message({
                    showClose: true,
                    message: msg,
                    type: 'success'
                });
            },
            error(msg) {

                this.$message({
                    showClose: true,
                    message: msg,
                    type: 'error'
                });
            },
            tableRowClassName({row, rowIndex}) {
                if (row.grade < 60) {
                    return 'warning-row'
                }
                return '';
            },
            handleEdit(index, row) {

            },
            /*更新学生分数*/
            update(row){
                axios({
                    method:'post',
                    url:'/web/a/updateGradeServlet',
                    data:{
                        code:row.code,
                        course:row.course,
                        grade:row.grade
                    }

                }).then(resp => {
                    if(resp.data === 'success'){
                        this.succ('修改成功');
                    }else{
                        this.error('修改失败');
                    }
                })
            }
        },
        data() {
            var stu = {
                code: '',
                name: '',
                sex: '',
                dept: '',
                course: '',
                grade: '',
            }
            return {
                tableData: [],
            }

        }
    });
</script>
</body>
</html>